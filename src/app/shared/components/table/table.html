@if (showFilter()) {
  <mat-form-field>
    <mat-label>Filter</mat-label>
    <input matInput (keyup)="applyFilter($event)" placeholder="Ex. Mia" #input>
  </mat-form-field>
}

<div class="table-container mat-elevation-z8">
  <table mat-table [dataSource]="matDataSource" matSort (matSortChange)="onSortChange($event)">
    <ng-container *ngFor="let column of displayedColumns()" [matColumnDef]="column.key">
      <th mat-header-cell *matHeaderCellDef mat-sort-header> 
        <span class="text-dark">{{ column.label | uppercase }}</span>
      </th>
      <td mat-cell *matCellDef="let row"> 
        @switch (row[column.key]?.type) {
          @case (tableSourceType.text) {
            @if (row[column.key]?.data; as data) {
              @if (data | isObject) {
                <span class="text-light">{{ data.name }}</span>
                <br>
                <span class="text-dark">{{ data.line }}</span>
              } @else {
                <span class="text-light">{{ data }}</span>
              }
            }
          }
          @case (tableSourceType.status) {
            @if (row[column.key]?.data; as status) {
              <div class="d-flex gap-1 align-items-center">
                <div class="status-point {{status?.color}}"></div>
                <span class="text-light">{{status?.name}}</span>
              </div>
            }
          }
          @case (tableSourceType.label) {
            {{ row[column.key] }}
        }
          @case (tableSourceType.user) {
            @if (row[column.key]?.data; as userName) {
              <div class="d-flex gap-1 align-items-center">
                <div class="user-label primary-gradient text-white d-flex justify-content-center align-items-center">
                  <span>{{userName | getInitials}}</span>
                </div>
                <span class="text-light">{{userName}}</span>
              </div>
            }
          }
          @case (tableSourceType.strong) {
            {{ row[column.key] }}
          }
        }
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumnKeys()"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumnKeys();"></tr>

    <!-- Row shown when there is no matching data. -->
    <tr class="mat-row" *matNoDataRow>
      <td class="mat-cell" colspan="4">No data matching</td>
    </tr>
  </table>
</div>